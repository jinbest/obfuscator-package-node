// *
// * Copyright 2020 Modaka Technologies ( https://modakatech.com )
// *
// * you are not use this file except in compliance with the License.
// * This file is used only for testing and none else can use any part of this code without agreement from Modaka Technologies.
// * Unless required by applicable law or agreed to in writing, software
// * See the License for the specific language governing permissions and
// * limitations under the License.

var _0x8a9c=['getElementById','TermCriteria','calcOpticalFlowPyrLK','blur','safari','pow','log','brightness','width','scaledMesh','#overlayVideo','CV_8UC4','apply','addFilter','maincamera','push','drawImage','TERM_CRITERIA_COUNT','Size','getImageData','COLOR_BGRA2GRAY','slice','beginPath','length','fill','delete','toString','cvtColor','sqrt','data32F','annotations','src','canvas','clearRect','getContext','leftEyeLower1','Mat','video','TERM_CRITERIA_EPS','offsetHeight','rotateY(180deg)','get','height','videoHeight','.loadingAnim','midwayBetweenEyes','arc','matFromArray','./img/images/face_shape2.png','silhouette','data','set','display','estimateFaces','fillText','videoWidth','rightEyeLower1','onload','createElement','#inputVideo','overlay2'];(function(_0x424e9e,_0x8a9ca){var _0x56f540=function(_0x14d632){while(--_0x14d632){_0x424e9e['push'](_0x424e9e['shift']());}};_0x56f540(++_0x8a9ca);}(_0x8a9c,0x14f));var _0x56f5=function(_0x424e9e,_0x8a9ca){_0x424e9e=_0x424e9e-0x0;var _0x56f540=_0x8a9c[_0x424e9e];return _0x56f540;};var winSize,criteria,maxLevel,DIST_VAL,p_lm,st,err,c_lm,srcMat,c_gray,p_gray,framesPerSec=0x1e,current_LM=[],previous_LM=[],arr=[],flag=-0x1,canvasInput=null,canvasInputCtx=null,imageData,video,videoWidth,videoHeight,count=0x0,filter;async function startProcessing(){var _0x1f3adb=_0x56f5;winSize=new cv[(_0x1f3adb('0x31'))](0xb,0xb),criteria=new cv[(_0x1f3adb('0x20'))](cv[_0x1f3adb('0x8')]|cv[_0x1f3adb('0x30')],0xa,0.03),maxLevel=0x2,DIST_VAL=0x3,p_lm=new cv[(_0x1f3adb('0x6'))](),st=new cv['Mat'](),err=new cv[(_0x1f3adb('0x6'))](),c_lm=new cv['Mat']();try{filter=new WebGLImageFilter();}catch(_0x15da74){console[_0x1f3adb('0x25')](_0x15da74);}var _0x14d632=screen[_0x1f3adb('0x27')]>0x280?0.15:0.15;filter[_0x1f3adb('0x2c')](_0x1f3adb('0x26'),_0x14d632),filter[_0x1f3adb('0x2c')](_0x1f3adb('0x22'),1.25),video=$('#inputVideo')['get'](0x0);let _0x17f13e=$('#overlayVideo')[_0x1f3adb('0xb')](0x0);videoWidth=video[_0x1f3adb('0x19')],videoHeight=video['videoHeight'],console[_0x1f3adb('0x25')](_0x1f3adb('0x7'),video['videoWidth'],video[_0x1f3adb('0xd')]),canvasInput=document[_0x1f3adb('0x1c')](_0x1f3adb('0x2')),canvasInput[_0x1f3adb('0x27')]=videoWidth,canvasInput['height']=videoHeight,canvasInputCtx=canvasInput['getContext']('2d'),srcMat=new cv[(_0x1f3adb('0x6'))](videoHeight,videoWidth,cv[_0x1f3adb('0x2a')]),c_gray=new cv[(_0x1f3adb('0x6'))](videoHeight,videoWidth,cv[_0x1f3adb('0x2a')]),p_gray=new cv[(_0x1f3adb('0x6'))](videoHeight,videoWidth,cv[_0x1f3adb('0x2a')]),src_tmp=new cv[(_0x1f3adb('0x6'))](),faceMat=new cv[(_0x1f3adb('0x6'))](),dsize=new cv[(_0x1f3adb('0x31'))](),mc_wd=stream[_0x1f3adb('0x19')]/document[_0x1f3adb('0x1f')](_0x1f3adb('0x2d'))['offsetWidth'],mc_ht=stream[_0x1f3adb('0xd')]/document['getElementById'](_0x1f3adb('0x2d'))[_0x1f3adb('0x9')],cntBrowser==_0x1f3adb('0x23')&&($(_0x1f3adb('0x29'))[_0x1f3adb('0xb')](0x0)['style']['webkitTransform']=_0x1f3adb('0xa')),startVideo();}function startVideo(){setInterval(function(){var _0x5483c2=_0x56f5;$(_0x5483c2('0xe'))['css'](_0x5483c2('0x16'),'none');if(MODE==LIVE_MODE)onPlay();},0x3e8/framesPerSec);}async function onPlay(){var _0x116c2d=_0x56f5;try{canvasInputCtx[_0x116c2d('0x2f')](video,0x0,0x0),imageData=canvasInputCtx[_0x116c2d('0x32')](0x0,0x0,videoWidth,videoHeight),srcMat['data'][_0x116c2d('0x15')](imageData[_0x116c2d('0x14')]);var _0x3e46dd=await faceModel['estimateFaces'](imageData);if(_0x3e46dd['length']>0x0){isModelLoaded=!![];count<0xa&&(_0x3e46dd=await faceModel[_0x116c2d('0x17')](imageData),count++);var _0x3eb89e=_0x3e46dd[0x0][_0x116c2d('0x0')][_0x116c2d('0x13')],_0x3ee093=_0x3e46dd[0x0][_0x116c2d('0x0')]['noseTip'];_0x3eb89e[_0x116c2d('0x2e')](_0x3ee093[0x0]);var _0x54b156=_0x3e46dd[0x0][_0x116c2d('0x0')][_0x116c2d('0x1a')],_0x7bd2aa=_0x3e46dd[0x0][_0x116c2d('0x0')][_0x116c2d('0x5')];for(var _0x4f7dfc=0x0;_0x4f7dfc<_0x54b156[_0x116c2d('0x36')];_0x4f7dfc++){_0x3eb89e[_0x116c2d('0x2e')](_0x54b156[_0x4f7dfc]);}for(var _0x4f7dfc=0x0;_0x4f7dfc<_0x7bd2aa[_0x116c2d('0x36')];_0x4f7dfc++){_0x3eb89e[_0x116c2d('0x2e')](_0x7bd2aa[_0x4f7dfc]);}var _0x53c8c3=_0x3e46dd[0x0]['annotations'][_0x116c2d('0xf')];_0x3eb89e[_0x116c2d('0x2e')](_0x53c8c3[0x0]);let _0x539902=_0x3e46dd[0x0][_0x116c2d('0x28')];_0x3eb89e['push'](_0x539902[0x86]),_0x3eb89e[_0x116c2d('0x2e')](_0x539902[0x168]),screen[_0x116c2d('0x27')]<0x400?HandelProduct(_0x3eb89e):(LK_stabilization_m1(srcMat,_0x3eb89e),HandelProduct(current_LM));}else!globalCapturedStatus&&(drawFaceNotFound(_0x116c2d('0x12')),drawVideo());}catch(_0x4c4d3b){console['log']('exception:',_0x4c4d3b);}}function LK_stabilization_m1(_0xc31a80,_0x3a00b6){var _0x47f08c=_0x56f5;try{if(flag==-0x1){cv['cvtColor'](_0xc31a80,p_gray,cv[_0x47f08c('0x33')]),arr=[],current_LM=[];for(var _0x3ccf47=0x0;_0x3ccf47<_0x3a00b6[_0x47f08c('0x36')];_0x3ccf47++){arr[_0x47f08c('0x2e')](_0x3a00b6[_0x3ccf47][0x0],_0x3a00b6[_0x3ccf47][0x1]),current_LM[_0x47f08c('0x2e')]([_0x3a00b6[_0x3ccf47][0x0],_0x3a00b6[_0x3ccf47][0x1]]);}previous_LM=current_LM,p_lm=cv[_0x47f08c('0x11')](_0x3a00b6[_0x47f08c('0x36')],0x2,cv['CV_32F'],arr),flag=0x1;}cv[_0x47f08c('0x3a')](_0xc31a80,c_gray,cv[_0x47f08c('0x33')]);if(p_gray[_0x47f08c('0x14')]){cv[_0x47f08c('0x21')](p_gray,c_gray,p_lm,c_lm,st,err,winSize,maxLevel,criteria);var _0x203fa1=euclidean_dts(p_lm[_0x47f08c('0x3c')],c_lm['data32F']);if(_0x203fa1>DIST_VAL){current_LM=[];for(var _0x3ccf47=0x0;_0x3ccf47<0x2*_0x3a00b6['length'];_0x3ccf47+=0x2){current_LM[_0x47f08c('0x2e')]([_0x3a00b6[_0x3ccf47/0x2][0x0],_0x3a00b6[_0x3ccf47/0x2][0x1]]),p_lm['data32F'][_0x3ccf47]=_0x3a00b6[_0x3ccf47/0x2][0x0],p_lm[_0x47f08c('0x3c')][_0x3ccf47+0x1]=_0x3a00b6[_0x3ccf47/0x2][0x1];}}else{current_LM=previous_LM['slice']();for(var _0x3ccf47=0x0;_0x3ccf47<0x2*current_LM['length'];_0x3ccf47+=0x2){p_lm[_0x47f08c('0x3c')][_0x3ccf47]=current_LM[_0x3ccf47/0x2][0x0],p_lm[_0x47f08c('0x3c')][_0x3ccf47+0x1]=current_LM[_0x3ccf47/0x2][0x1];}}}c_gray['copyTo'](p_gray),c_lm[_0x47f08c('0x38')](),c_lm=new cv[(_0x47f08c('0x6'))](),previous_LM=current_LM[_0x47f08c('0x34')]();}catch(_0x321015){console[_0x47f08c('0x25')](_0x321015);(videoWidth!=$('#inputVideo')[_0x47f08c('0xb')](0x0)[_0x47f08c('0x19')]||videoHeight!=$(_0x47f08c('0x1d'))['get'](0x0)[_0x47f08c('0xd')])&&(stream=$(_0x47f08c('0x1d'))[_0x47f08c('0xb')](0x0),videoWidth=stream['videoWidth'],videoHeight=stream[_0x47f08c('0xd')],_0xc31a80=new cv[(_0x47f08c('0x6'))](videoHeight,videoWidth,cv['CV_8UC4']),c_gray=new cv['Mat'](videoHeight,videoWidth,cv[_0x47f08c('0x2a')]),p_gray=new cv[(_0x47f08c('0x6'))](videoHeight,videoWidth,cv[_0x47f08c('0x2a')]));current_LM=[];for(var _0x3ccf47=0x0;_0x3ccf47<0x2*_0x3a00b6[_0x47f08c('0x36')];_0x3ccf47+=0x2){current_LM[_0x47f08c('0x2e')]([_0x3a00b6[_0x3ccf47/0x2][0x0],_0x3a00b6[_0x3ccf47/0x2][0x1]]),p_lm[_0x47f08c('0x3c')][_0x3ccf47]=_0x3a00b6[_0x3ccf47/0x2][0x0],p_lm[_0x47f08c('0x3c')][_0x3ccf47+0x1]=_0x3a00b6[_0x3ccf47/0x2][0x1];}}}function euclidean_dts(_0x268272,_0x3e01c0){var _0x36b32e=_0x56f5;let _0xf9a42=0x0,_0x54a320=0x0,_0x58e909=0x0,_0x46f21f=new Array();if(_0x268272[_0x36b32e('0x36')]==_0x3e01c0[_0x36b32e('0x36')]){for(i=0x0;i<_0x268272[_0x36b32e('0x36')];i+=0x2){dist=Math[_0x36b32e('0x3b')](Math[_0x36b32e('0x24')](_0x268272[i]-_0x3e01c0[i],0x2)+Math[_0x36b32e('0x24')](_0x268272[i+0x1]-_0x3e01c0[i+0x1],0x2)),_0xf9a42+=dist,_0x46f21f[_0x36b32e('0x2e')](dist);}return _0x54a320=_0xf9a42/_0x46f21f[_0x36b32e('0x36')],_0x54a320;}return _0x58e909;}function drawPoint(_0x1b5d4e,_0x46d313,_0x2d34bd,_0x41d9c2){var _0x4721a0=_0x56f5;_0x1b5d4e[_0x4721a0('0x35')](),_0x1b5d4e[_0x4721a0('0x10')](_0x46d313,_0x2d34bd,_0x41d9c2,0x0,0x2*Math['PI']),_0x1b5d4e[_0x4721a0('0x37')]();}function drawLandmarks(_0x262ef7){var _0x1a6c9e=_0x56f5,_0x5caec3=document[_0x1a6c9e('0x1f')](_0x1a6c9e('0x1e')),_0x4a033d=_0x5caec3[_0x1a6c9e('0x4')]('2d');_0x4a033d['clearRect'](0x0,0x0,_0x5caec3[_0x1a6c9e('0x27')],_0x5caec3[_0x1a6c9e('0xc')]),_0x4a033d[_0x1a6c9e('0x35')]();var _0x25ae88=0x6,_0x3d82a7=_0x25ae88/0x2;_0x4a033d['fillStyle']='yellow';var _0x5dd5e2=0x0;for(let _0x1929cb=0x0;_0x1929cb<_0x262ef7[_0x1a6c9e('0x36')];_0x1929cb++){const _0x99a03f=_0x262ef7[_0x1929cb][0x0],_0x55b785=_0x262ef7[_0x1929cb][0x1];_0x4a033d[_0x1a6c9e('0x18')](_0x1929cb[_0x1a6c9e('0x39')](),_0x5caec3[_0x1a6c9e('0x27')]-_0x99a03f,_0x55b785);}drawVideo();}function drawVideo(){var _0x5ba23a=_0x56f5,_0x337d5f=filter[_0x5ba23a('0x2b')](imageData);MODE==LIVE_MODE&&ctxVideo[_0x5ba23a('0x2f')](_0x337d5f,0x0,0x0);}function drawFaceNotFound(_0x2fc037){var _0x146803=_0x56f5;leftctx[_0x146803('0x3')](0x0,0x0,midcanvas['width'],midcanvas['height']),rightctx['clearRect'](0x0,0x0,midcanvas[_0x146803('0x27')],midcanvas['height']);var _0xce6ba7=new Image();_0xce6ba7[_0x146803('0x1')]=_0x2fc037,_0xce6ba7[_0x146803('0x1b')]=function(){var _0x42c79a=_0x146803;let _0x56065f=screen[_0x42c79a('0x27')]/midcanvas[_0x42c79a('0x27')];midctx[_0x42c79a('0x3')](0x0,0x0,midcanvas[_0x42c79a('0x27')],midcanvas[_0x42c79a('0xc')]);var _0x679e5b=midcanvas[_0x42c79a('0x27')]/0x3+_0x56065f*midcanvas[_0x42c79a('0x27')]/0x3,_0x38122e=1.2*_0x679e5b;screen[_0x42c79a('0x27')]<0x400&&(_0x679e5b=_0x679e5b*0x1,_0x38122e=_0x38122e*0x1);var _0x595ca6=(midcanvas[_0x42c79a('0x27')]-_0x679e5b)/0x2,_0x132eb8=midcanvas[_0x42c79a('0xc')]/0xf;screen[_0x42c79a('0x27')]<0x400?midctx[_0x42c79a('0x2f')](_0xce6ba7,0x0,0x0,_0xce6ba7[_0x42c79a('0x27')],_0xce6ba7[_0x42c79a('0xc')],_0x595ca6,_0x132eb8*0x2,_0x679e5b*0x1,_0x38122e*0x1):midctx[_0x42c79a('0x2f')](_0xce6ba7,0x0,0x0,_0xce6ba7[_0x42c79a('0x27')],_0xce6ba7[_0x42c79a('0xc')],_0x595ca6*0x2,_0x132eb8*0x2,_0x679e5b*0.5,_0x38122e*0.5);};}